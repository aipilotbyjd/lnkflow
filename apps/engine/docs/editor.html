<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkFlow Workflow Editor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #1a1a2e; color: #fff; overflow: hidden; }

        .container { display: flex; height: 100vh; }

        /* Sidebar */
        .sidebar { width: 260px; background: #16213e; border-right: 1px solid #0f3460; padding: 16px; overflow-y: auto; }
        .sidebar h2 { font-size: 14px; color: #888; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; }
        .node-palette { display: flex; flex-direction: column; gap: 8px; margin-bottom: 24px; }
        .palette-node { padding: 12px 16px; background: #0f3460; border-radius: 8px; cursor: grab; transition: all 0.2s; border: 1px solid transparent; }
        .palette-node:hover { background: #1a4080; border-color: #4a9eff; }
        .palette-node .icon { font-size: 18px; margin-right: 8px; }
        .palette-node .label { font-size: 13px; }

        .palette-node.trigger { border-left: 3px solid #10b981; }
        .palette-node.action { border-left: 3px solid #3b82f6; }
        .palette-node.logic { border-left: 3px solid #f59e0b; }
        .palette-node.output { border-left: 3px solid #8b5cf6; }

        /* Canvas */
        .canvas-container { flex: 1; position: relative; overflow: hidden; }
        #canvas { width: 100%; height: 100%; background: radial-gradient(circle at 1px 1px, #2a2a4a 1px, transparent 0); background-size: 24px 24px; }

        /* Nodes */
        .workflow-node { position: absolute; min-width: 180px; background: #1e293b; border: 2px solid #334155; border-radius: 12px; cursor: move; user-select: none; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .workflow-node:hover { border-color: #4a9eff; }
        .workflow-node.selected { border-color: #4a9eff; box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.3); }
        .workflow-node.trigger { border-top: 3px solid #10b981; }
        .workflow-node.action { border-top: 3px solid #3b82f6; }
        .workflow-node.logic { border-top: 3px solid #f59e0b; }
        .workflow-node.output { border-top: 3px solid #8b5cf6; }

        .node-header { padding: 12px 16px; border-bottom: 1px solid #334155; display: flex; align-items: center; gap: 8px; }
        .node-header .icon { font-size: 16px; }
        .node-header .title { font-size: 13px; font-weight: 600; }
        .node-body { padding: 12px 16px; font-size: 12px; color: #94a3b8; }

        /* Handles */
        .handle { position: absolute; width: 12px; height: 12px; background: #475569; border: 2px solid #1e293b; border-radius: 50%; cursor: crosshair; z-index: 10; }
        .handle:hover { background: #4a9eff; transform: scale(1.2); }
        .handle.input { left: -6px; top: 50%; transform: translateY(-50%); }
        .handle.output { right: -6px; top: 50%; transform: translateY(-50%); }
        .handle.connected { background: #4a9eff; }

        /* SVG for edges */
        #edges-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .edge { stroke: #4a9eff; stroke-width: 2; fill: none; }
        .edge-temp { stroke: #4a9eff; stroke-width: 2; stroke-dasharray: 5,5; fill: none; }

        /* Toolbar */
        .toolbar { position: absolute; top: 16px; right: 16px; display: flex; gap: 8px; }
        .toolbar button { padding: 10px 16px; background: #0f3460; border: 1px solid #1a4080; color: #fff; border-radius: 8px; cursor: pointer; font-size: 13px; transition: all 0.2s; }
        .toolbar button:hover { background: #1a4080; }
        .toolbar button.primary { background: #3b82f6; border-color: #3b82f6; }
        .toolbar button.danger { background: #ef4444; border-color: #ef4444; }
        .toolbar button:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Output Panel */
        .output-panel { width: 400px; background: #16213e; border-left: 1px solid #0f3460; display: flex; flex-direction: column; }
        .output-header { padding: 16px; border-bottom: 1px solid #0f3460; display: flex; justify-content: space-between; align-items: center; }
        .output-header h3 { font-size: 14px; }
        .tabs { display: flex; gap: 8px; }
        .tab { padding: 6px 12px; background: transparent; border: none; color: #888; cursor: pointer; border-radius: 6px; font-size: 12px; }
        .tab.active { background: #0f3460; color: #fff; }
        .output-content { flex: 1; padding: 16px; overflow-y: auto; font-family: 'Monaco', 'Menlo', monospace; font-size: 12px; }
        .output-content pre { white-space: pre-wrap; word-break: break-all; background: #0d1b2a; padding: 12px; border-radius: 8px; color: #4ade80; }

        /* Validation */
        .validation-list { list-style: none; }
        .validation-item { padding: 8px 12px; background: #0d1b2a; margin-bottom: 8px; border-radius: 6px; border-left: 3px solid #ef4444; }
        .validation-item.success { border-color: #10b981; }

        /* Status bar */
        .status-bar { position: absolute; bottom: 16px; left: 50%; transform: translateX(-50%); padding: 8px 16px; background: #0f3460; border-radius: 20px; font-size: 12px; color: #888; }

        /* Auth panel */
        .auth-panel { position: absolute; top: 60px; right: 16px; background: #16213e; padding: 16px; border-radius: 8px; border: 1px solid #0f3460; min-width: 280px; }
        .auth-panel label { display: block; font-size: 11px; color: #888; margin-bottom: 4px; margin-top: 12px; }
        .auth-panel label:first-child { margin-top: 0; }
        .auth-panel input, .auth-panel select { width: 100%; padding: 8px; background: #0d1b2a; border: 1px solid #334155; border-radius: 6px; color: #fff; font-size: 12px; }
        .auth-panel button { width: 100%; margin-top: 12px; padding: 10px; background: #3b82f6; border: none; color: #fff; border-radius: 6px; cursor: pointer; font-size: 13px; }
        .auth-panel button:hover { background: #2563eb; }
        .auth-panel .status { margin-top: 8px; font-size: 11px; padding: 8px; border-radius: 4px; }
        .auth-panel .status.success { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .auth-panel .status.error { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .auth-panel .user-info { margin-top: 12px; padding: 12px; background: #0d1b2a; border-radius: 6px; }
        .auth-panel .user-info .name { font-weight: 600; color: #fff; }
        .auth-panel .user-info .email { font-size: 11px; color: #64748b; }
        .auth-panel .logout-btn { background: #334155; margin-top: 8px; }

        /* Execution log */
        .exec-log { background: #0d1b2a; border-radius: 8px; padding: 12px; margin-bottom: 12px; }
        .exec-log .header { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .exec-log .exec-id { color: #4ade80; font-family: monospace; }
        .exec-log .status { padding: 2px 8px; border-radius: 4px; font-size: 11px; }
        .exec-log .status.running { background: #3b82f6; }
        .exec-log .status.completed { background: #10b981; }
        .exec-log .status.failed { background: #ef4444; }
        .exec-log .status.pending { background: #f59e0b; }
        .exec-log .events { font-size: 11px; color: #888; }
        .exec-log .event { padding: 4px 0; border-bottom: 1px solid #1e293b; }
        .exec-log .event:last-child { border-bottom: none; }

        /* Node execution state */
        .workflow-node.executing { border-color: #3b82f6; box-shadow: 0 0 12px rgba(59, 130, 246, 0.5); }
        .workflow-node.completed { border-color: #10b981; }
        .workflow-node.failed { border-color: #ef4444; }

        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h2>Triggers</h2>
            <div class="node-palette">
                <div class="palette-node trigger" draggable="true" data-type="trigger_manual">
                    <span class="icon">‚ñ∂Ô∏è</span>
                    <span class="label">Manual Trigger</span>
                </div>
                <div class="palette-node trigger" draggable="true" data-type="trigger_webhook">
                    <span class="icon">üîó</span>
                    <span class="label">Webhook Trigger</span>
                </div>
                <div class="palette-node trigger" draggable="true" data-type="trigger_schedule">
                    <span class="icon">‚è∞</span>
                    <span class="label">Schedule Trigger</span>
                </div>
                <div class="palette-node trigger" draggable="true" data-type="trigger_event">
                    <span class="icon">üì°</span>
                    <span class="label">Event Trigger</span>
                </div>
            </div>

            <h2>Actions</h2>
            <div class="node-palette">
                <div class="palette-node action" draggable="true" data-type="action_http">
                    <span class="icon">üåê</span>
                    <span class="label">HTTP Request</span>
                </div>
                <div class="palette-node action" draggable="true" data-type="action_script">
                    <span class="icon">üìù</span>
                    <span class="label">Run Script</span>
                </div>
                <div class="palette-node action" draggable="true" data-type="action_transform">
                    <span class="icon">üîÑ</span>
                    <span class="label">Transform Data</span>
                </div>
                <div class="palette-node action" draggable="true" data-type="action_delay">
                    <span class="icon">‚è≥</span>
                    <span class="label">Delay</span>
                </div>
            </div>

            <h2>Logic</h2>
            <div class="node-palette">
                <div class="palette-node logic" draggable="true" data-type="logic_condition">
                    <span class="icon">‚ùì</span>
                    <span class="label">Condition (If/Else)</span>
                </div>
                <div class="palette-node logic" draggable="true" data-type="logic_switch">
                    <span class="icon">üîÄ</span>
                    <span class="label">Switch</span>
                </div>
                <div class="palette-node logic" draggable="true" data-type="logic_loop">
                    <span class="icon">üîÅ</span>
                    <span class="label">Loop</span>
                </div>
                <div class="palette-node logic" draggable="true" data-type="logic_parallel">
                    <span class="icon">‚ö°</span>
                    <span class="label">Parallel</span>
                </div>
            </div>

            <h2>Output</h2>
            <div class="node-palette">
                <div class="palette-node output" draggable="true" data-type="output_response">
                    <span class="icon">üì§</span>
                    <span class="label">Response</span>
                </div>
                <div class="palette-node output" draggable="true" data-type="output_log">
                    <span class="icon">üìã</span>
                    <span class="label">Log</span>
                </div>
            </div>
        </div>

        <div class="canvas-container">
            <svg id="edges-svg"></svg>
            <div id="canvas"></div>

            <div class="toolbar">
                <button onclick="clearCanvas()">Clear</button>
                <button onclick="validateWorkflow()">Validate</button>
                <button class="primary" onclick="executeWorkflow()" id="executeBtn">‚ñ∂ Execute</button>
                <button onclick="exportWorkflow()">Export JSON</button>
                <button onclick="loadSample()">Load Sample</button>
            </div>

            <!-- Auth Panel -->
            <div class="auth-panel" id="authPanel">
                <div id="loginForm">
                    <div style="font-size:14px;font-weight:600;margin-bottom:12px;">üîê Login to Execute</div>
                    <label>API URL:</label>
                    <input type="text" id="apiUrl" value="http://localhost:8000" placeholder="http://localhost:8000">
                    <label>Email:</label>
                    <input type="email" id="email" value="demo@linkflow.test" placeholder="demo@linkflow.test">
                    <label>Password:</label>
                    <input type="password" id="password" value="demo1234" placeholder="demo1234">
                    <button onclick="login()">Login</button>
                    <div style="margin-top:8px;font-size:10px;color:#64748b;">
                        Demo: demo@linkflow.test / demo1234
                    </div>
                    <div id="loginStatus"></div>
                </div>

                <div id="userPanel" style="display:none;">
                    <div class="user-info">
                        <div class="name" id="userName"></div>
                        <div class="email" id="userEmail"></div>
                    </div>
                    <label>Workspace:</label>
                    <select id="workspaceSelect" onchange="loadWorkflows()"></select>
                    <label>Workflow:</label>
                    <select id="workflowSelect" onchange="loadWorkflowToCanvas()"></select>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>

            <div class="status-bar" id="status">Login to execute workflows on your API</div>
        </div>

        <div class="output-panel">
            <div class="output-header">
                <h3>Output</h3>
                <div class="tabs">
                    <button class="tab active" onclick="showTab('json')">JSON</button>
                    <button class="tab" onclick="showTab('dag')">DAG Info</button>
                    <button class="tab" onclick="showTab('validation')">Validation</button>
                    <button class="tab" onclick="showTab('execution')">Execution</button>
                </div>
            </div>
            <div class="output-content" id="output">
                <pre id="json-output">{}</pre>
                <div id="dag-output" style="display:none;"></div>
                <ul id="validation-output" class="validation-list" style="display:none;"></ul>
                <div id="execution-output" style="display:none;"></div>
            </div>
        </div>
    </div>

    <script src="editor.js"></script>
</body>
</html>
